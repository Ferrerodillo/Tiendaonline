<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acceso a Firebase Realtime Database</title>
</head>
<body>
    <h1>Datos de Firebase Realtime Database</h1>

    <div id="data-display"></div>

    <input type="text" id="messageInput" placeholder="Escribe tu mensaje">
    <button id="sendMessageButton">Enviar mensaje</button>

    <script src="https://www.gstatic.com/firebasejs/9.6.4/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.4/firebase-database-compat.js"></script>

    <script>
        // Tu configuración de Firebase (reemplaza con la tuya)
const firebaseConfig = {
  apiKey: "AIzaSyATKAFNmwhe9X0GQ5GxHiSmc3wiOhb7j18",
  authDomain: "rodillo-2b699.firebaseapp.com",
  databaseURL: "https://rodillo-2b699-default-rtdb.firebaseio.com",
  projectId: "rodillo-2b699",
  storageBucket: "rodillo-2b699.firebasestorage.app",
  messagingSenderId: "652395478682",
  appId: "1:652395478682:web:f4447c35fee0599030a923"
};

        // Inicializa Firebase
        firebase.initializeApp(firebaseConfig);

        // Obtén una referencia a la base de datos
        const database = firebase.database();
        const messagesRef = database.ref('messages'); // 'messages' es el nodo raíz donde guardaremos los mensajes

        // Referencias a elementos del DOM
        const dataDisplay = document.getElementById('data-display');
        const messageInput = document.getElementById('messageInput');
        const sendMessageButton = document.getElementById('sendMessageButton');

        // --- Funcionalidad para LEER datos ---
        // Escucha cambios en el nodo 'messages'
        messagesRef.on('value', (snapshot) => {
            dataDisplay.innerHTML = ''; // Limpia el contenido anterior

            const data = snapshot.val(); // Obtiene los datos del snapshot

            if (data) {
                // Itera sobre los mensajes y los muestra
                for (let key in data) {
                    const messageElement = document.createElement('p');
                    messageElement.textContent = `Mensaje: ${data[key].text}`;
                    dataDisplay.appendChild(messageElement);
                }
            } else {
                dataDisplay.textContent = 'No hay mensajes aún.';
            }
        });

        // --- Funcionalidad para ESCRIBIR datos ---
        sendMessageButton.addEventListener('click', () => {
            const messageText = messageInput.value.trim();

            if (messageText !== '') {
                // push() genera una clave única para cada nuevo mensaje
                messagesRef.push({
                    text: messageText,
                    timestamp: firebase.database.ServerValue.TIMESTAMP // Agrega un timestamp del servidor
                })
                .then(() => {
                    messageInput.value = ''; // Limpia el input después de enviar
                })
                .catch((error) => {
                    console.error("Error al escribir el mensaje: ", error);
                });
            }
        });
    </script>
</body>
</html>

